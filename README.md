# 2024-5-Embedded-SW

이 레포지토리는 2024년도 5학기 **임베디드 소프트웨어** 교과목의 강의 및 기말 프로젝트 자료를 포함하고 있습니다.

## 📁 디렉토리 구성

- `in_lecture/`: 강의 시간에 실습 및 예제로 작성한 코드들이 포함되어 있습니다.
- `final_project/`: 기말 프로젝트 관련 코드 및 자료들이 포함되어 있습니다.

---

## 🎓 기말 프로젝트: 자동 분류 구슬 경사로 시스템

- 아래 기말프로젝트의 자세한 내용을 포함하는 보고서는 `Final_PJ_Reposrt.pdf` 를 확인하십시오.

### 📝 프로젝트 개요
본 프로젝트는 **물리 기반의 구슬 분류 시스템**으로, 경사면을 따라 내려오는 구슬들을 사전에 지정된 순서에 따라 특정 홀에 떨어뜨리는 임베디드 제어 시스템을 구현하는 것입니다.

### 🛠️ 하드웨어 구성
- **프레임 구조**: 1.2m 높이의 해체된 책상 프레임 활용, 아크릴 그리드 및 경사로를 3D 프린팅 및 레이저 커팅으로 제작.
- **센서부**: 레이저와 디지털화된 CdS 센서를 사용하여 구슬의 통과 감지.
- **액추에이터부**: MG90S 서보모터와 회전 가능한 구조물을 통해 구슬을 홀로 유도.
- **입력 인터페이스**: 푸시 스위치 4개를 이용하여 구슬의 목표 홀 순서를 입력.
- **출력 인터페이스**: 3개의 7-Segment 디스플레이로 각 홀에 떨어진 구슬 수를 실시간 표시.

### ⚙️ 소프트웨어 로직

- 모든 함수는 고수준 라이브러리 없이 로우레벨 방식으로 직접 구현되었습니다.
- **센서**는 외부 인터럽트(EXTI)를 통해 이벤트를 감지하고,
- **서보모터**는 타이머(PWM, TIM3 CH1/CH2)를 통해 제어합니다.
- **시간 측정**은 TIM2의 CNT 값과 Capture/Compare Register(CCR)을 통해 정밀하게 수행합니다.
- **구슬 순서 판단**은 두 센서 간 시간차를 통해 각 구슬의 이동 시간을 분석하여 결정합니다.
- **7-Segment 제어**는 7447 디코더 IC를 이용하여 착시 효과를 기반으로 3개를 동시에 표현합니다.

### ⏱️ 시간 기반 제어 모델
- 첫 번째 구슬이 두 센서 사이를 통과하는 시간(`t₀`)을 기준으로 삼아 물리 모델을 생성.
- 이후 도착 시간을 계산하고, 필요한 시점에 서보모터를 회전시켜 구슬이 정확한 위치로 이동하도록 제어.

### 📐 주요 물리 모델
- 등가속운동 기반 거리-시간 관계식을 이용하여 `√(t₀² + c)` 형태로 다음 도착 시간을 유도.
- 배열(`td2[]`, `td3[]`, `td4[]`)을 통해 각 구슬의 도착 예정 시간을 저장 및 업데이트.

### 🔌 핀 배치 요약

| 기능 | 핀 | GPIO | 기타 |
|------|-----|--------|-------|
| Sensor1 | ARD-D2 | PG6 | EXTI6 |
| Sensor2 | ARD-D3 | PB4 | EXTI4 |
| Actuator1 | ARD-D1 | PC6 | TIM3 CH1 |
| Actuator2 | ARD-D0 | PC7 | TIM3 CH2 |
| Switch1~4 | ARD-A0~A3 | PA0, PF10, PF9, PF8 | 입력 |
| Segment 제어 | ARD-D4~D10 | PG7, PA8, PA2, ... | 7447 & 세그먼트 |